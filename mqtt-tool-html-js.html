<!DOCTYPE html>
<html>
<head>
  <title>MQTT Tool in HTML + JS</title>
  <script src="mqttws31.js"></script>
</head>
<body>
  <h1>MQTT Tool in HTML + JS</h1>
  <p>Written by Alex Leong from <a href="https://www.vyrox.com">VYROX IoT</a></p>
 
 <label for="mqtt_broker" id="mqtt_broker_text">MQTT Broker (Server): </label>

<label> <input type="radio" name="mqtt_server" id="mosquitto_radio" value="test.mosquitto.org"> <span for="mosquitto_radio">test.mosquitto.org </span></label>

 <label>  <input type="radio" name="mqtt_server" id="emqx_radio" value="broker.emqx.io"> <span for="emqx_radio">broker.emqx.io </span></label>

<label>   <input type="radio" name="mqtt_server" id="mqtthq_radio" value="public.mqtthq.com"> <span for="mqtthq_radio">public.mqtthq.com </span></label>

 <label>   <input type="radio" name="mqtt_server" id="other_radio" value="other_server"> <span for="other_radio">Other (Custom)</span></label>

<label>
<input type="checkbox" name="checkbox3_input" id="checkbox3_input" onchange="checkbox3Changed()">
<span for="checkbox3_input" id="checkbox3_text">Automatic Connect</span>
</label> 

  <br><br>

  <label for="hostname_input" id="hostname_text" hidden>Hostname: </label>
  <input type="text" id="hostname_input" value="test.mosquitto.org" size="20" onchange="hostnameChanged()" disabled hidden>

  <label for="port1_input" id="port1_text" hidden>Port: </label>
 <select id="port1_input" hidden>
    <option value="1883">1883 (unencrypted, unauthenticated)</option>
    <option value="1884">1884 (unencrypted, authenticated)</option>
    <option value="8883">8883 (encrypted, unauthenticated)</option>
    <option value="8884">8884 (encrypted, client certificate required)</option>
    <option value="8885">8885 (encrypted, authenticated)</option>
    <option value="8886">8886 (encrypted, unauthenticated)</option>
    <option value="8887">8887 (encrypted, server certificate deliberately expired)</option>
    <option value="8080">8080 (WebSockets, unencrypted, unauthenticated)</option>
    <option value="8081" selected>8081 (WebSockets, encrypted, unauthenticated)</option>
    <option value="8090">8090 (WebSockets, unencrypted, authenticated)</option>
    <option value="8091">8091 (WebSockets, encrypted, authenticated)</option>
    </select>


  <label for="port2_input" id="port2_text" hidden>Port:</label>
 <select id="port2_input" hidden>
    <option value="1883">1883 (TCP)</option>
    <option value="8083" >8083 (WebSocket)</option>
    <option value="8883">8883 (SSL/TLS)</option>
    <option value="8084" selected>8084 (WebSocket Secure)</option>
    </select>


  <label for="port3_input" id="port3_text" hidden>Port: </label>
 <select id="port3_input" hidden>
    <option value="1883">1883 (TCP)</option>
    <option value="8083" >8083 (WebSocket)</option>
    <option value="8084" selected>8084 (WebSocket Secure)</option>
    </select>


  <label for="port9_input" id="port9_text" hidden>Port: </label>
  <input type="text" id="port9_input" size="3" onchange="port9Changed()" hidden>

<br><br>

<label for="ssl_input" id="ssl_text" hidden>Use SSL: </label>
<select id="ssl_input" hidden onchange="onSSLChange()">
  <option value="true" >Yes</option>
  <option value="false">No</option>
</select>

<label for="auth_input" id="auth_text" hidden>Required Login: </label>
<select id="auth_input" onchange="onAUTHChange()" hidden>
  <option value="true">Yes</option>
  <option value="false" selected>No</option>
</select>

  <label for="username_input" id="username_text" hidden>Username: </label>
  <input type="text" id="username_input" onchange="usernameChanged()" hidden>

  <label for="password_input" id="password_text" hidden>Password: </label>
  <input type="text" id="password_input" onchange="passwordChanged()" hidden>

<br><br>

 <label for="timeout_input" id="timeout_text" hidden>Connection Timeout (Second): </label>
  <input type="text" id="timeout_input" value="5" size="1" onchange="timeoutChanged()" hidden>



  <button id="connect_button" type="button" onclick="connect();" hidden>Connect</button>
  <button id="disconnect_button" type="button" onclick="disconnect();" hidden>Disconnect</button>

  <br><br>

<span id="connectiontext" hidden>Connection </span>
<span id="failedcounttext" hidden>Failed: </span><span id="failedcount" hidden>0</span>
<span id="bar" hidden> | </span>
<span id="lostcounttext" hidden>Lost: </span><span id="lostcount" hidden>0</span>
<button id="reset_button" type="button" onclick="resetcounter();" hidden>Reset Counters</button>

<label>
<input type="checkbox" name="checkbox1_input" id="checkbox1_input" onchange="checkbox1Changed()" hidden>
<span for="checkbox1_input" id="checkbox1_text" hidden>Automatic Reconnect Upon Connection Failed/Lost</span>
</label> 


  <br><br>

  <label for="topic_input" id="topic_text" hidden>Topic:</label>
  <input type="text" id="topic_input" onchange="topicChanged()" hidden>

 <label for="subqos_input" id="subqos_text" hidden>QoS: </label>
 <select id="subqos_input" onchange="subqosChanged()" hidden>
    <option value="0">0 (At most once)</option>
    <option value="1">1 (At least once)</option>
    <option value="2" selected>2 (Exactly once)</option>
    </select>

  <button id="subscribe_button" type="button" onclick="subscribe();" hidden>Subscribe</button>
  <button id="unsubscribe_button" type="button" onclick="unsubscribe();" hidden>Unsubscribe</button> 
  
  <label>
<input type="checkbox" name="sendhex_input" id="sendhex_input" onchange="sendhexchanged()" hidden>
<span for="sendhex_input" id="sendhex_text" hidden>Send/Receive in HEX</span>
</label> 


  <br>
  <br>

  <label for="message_input" id="message_text" hidden>Message:</label>
  <input type="text" id="message_input" onchange="messageChanged()" hidden>
  

  <label for="sendqos_input" id="sendqos_text" hidden>QoS: </label>
 <select id="sendqos_input" onchange="sendqosChanged()" hidden>
    <option value="0">0 (At most once)</option>
    <option value="1">1 (At least once)</option>
    <option value="2" selected>2 (Exactly once)</option>
    </select>

  <label for="retain_input" id="retain_text" hidden>Retain: </label>
 <select id="retain_input" onchange="retainChanged()" hidden>
    <option value="true" selected>Yes</option>
    <option value="false">No</option>
    </select>


  <button id="send_button" type="button" onclick="send();" hidden>Publish</button> 
<label>
<span for "checkbox2" id="checkbox2text" hidden> <input type="checkbox" name="checkbox2" id="checkbox2" onchange="checkbox2Changed()" hidden> Automatic Send Random Message At One-Second Intervals</span></label>

  <br>
  <br>

  <button id="clear_button" type="button" onclick="clearConsole();" hidden>Clear Console</button>

  <br>
  <br>

  <div id="console"></div> <!-- Display console messages here -->

  <script>
    // Global variables
    var client;
var options = {};
let responseObject;
let errorMessage;
let error;
let errorCode;


    // These are configs	
    var hostname;
    var port;
    var topic;
    var clientId;
    var ip;
    var username;
    var password;

    var storage = localStorage;
    var value = storage.getItem('key');
    if (value === '1') {document.getElementById("checkbox3_input").checked = true;}



function onSSLChange() {
  var useSSLDropdown = document.getElementById("ssl_input");
  options.useSSL = useSSLDropdown.value;

var otherradioselected = document.getElementById("other_radio");
 if (otherradioselected.checked) {
 var selectssl = document.getElementById("ssl_input");
var selectedsslOption = selectssl.selectedIndex ;
localStorage.setItem('selectedsslOption', selectedsslOption);
}

}

function onAUTHChange() {

 document.getElementById('username_input').value = storage.getItem('customusername');
 document.getElementById('password_input').value = storage.getItem('custompassword');

  var useAUTHDropdown = document.getElementById("auth_input");

if (useAUTHDropdown.value === "true")
{
document.getElementById('username_text').hidden = false;
document.getElementById('username_input').hidden = false;
document.getElementById('password_text').hidden = false;
document.getElementById('password_input').hidden = false; }

if (useAUTHDropdown.value === "false")
{
document.getElementById('username_text').hidden = true;
document.getElementById('username_input').hidden = true;
document.getElementById('password_text').hidden = true;
document.getElementById('password_input').hidden = true; }

  options.useAUTH = useAUTHDropdown.value;

var otherradioselected = document.getElementById("other_radio");

if (otherradioselected.checked) {
var selectauth = document.getElementById("auth_input");
var selectedauthOption = selectauth.selectedIndex ;
localStorage.setItem('selectedauthOption', selectedauthOption);

}


}

async function connect() {

stopCountup();


document.getElementById('hostname_input').placeholder = '';
document.getElementById('port9_input').placeholder = '';
document.getElementById('username_input').placeholder = '';
document.getElementById('password_input').placeholder = '';

 //clearConsole();

     // Get input values
      var mosquittoRadio = document.getElementById("mosquitto_radio");
      var emqxRadio = document.getElementById("emqx_radio");
      var mqtthqRadio = document.getElementById("mqtthq_radio");
      var otherRadio = document.getElementById("other_radio");

       port1Input = document.getElementById("port1_input");
       port2Input = document.getElementById("port2_input");
       port3Input = document.getElementById("port3_input");
       port9Input = document.getElementById("port9_input");
 
     if (mosquittoRadio.checked) {port = port1Input.value;}
     if (emqxRadio.checked) {port = port2Input.value;} 
     if (mqtthqRadio.checked) {port = port3Input.value;} 
     if (otherRadio.checked) {hostname = storage.getItem('customhostname'); port = port9Input.value;} 

hostname = document.getElementById('hostname_input').value;

      if (hostname === '') {
document.getElementById('hostname_input').placeholder = 'Please enter hostname!';
      return; // Stop further execution
      }

      if (port === '') {
document.getElementById('port9_input').placeholder = 'Please enter port!';
      return; // Stop further execution
      }

username = document.getElementById('username_input').value;
password = document.getElementById('password_input').value;

var authdropdown = document.getElementById('auth_input');
	
if (authdropdown.value  ===  'true'){
  if (username === '') {
        document.getElementById('username_input').placeholder = 'Please enter username!';

        return; // Stop further execution
      }

  if (password === '') {
        document.getElementById('password_input').placeholder = 'Please enter password!';

        return; // Stop further execution
      }

}

let ipPattern = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
let domainPattern = /^((?!-)[A-Za-z0-9-]{1,63}(?<!-)\.)+[A-Za-z]{2,63}$/i;


// Assuming ipPattern and domainPattern are regular expressions for IP and domain respectively
if (domainPattern.test(hostname)) {
   ip = await resolveDomain(hostname); // Pass hostname to the resolveDomain function
} else if (ipPattern.test(hostname)) {
   ip = hostname;
} else {
   document.getElementById('hostname_input').value = '';
   document.getElementById('hostname_input').placeholder = 'Please enter valid hostname!';
   return; // Stop further execution
}


    // Create client ID or load from storage
    if (window.sessionStorage.clientId) {
 clientId = "" + parseInt(Math.random() * 100000, 10);
    //  clientId = window.sessionStorage.clientId;
    } else {
      clientId = "" + parseInt(Math.random() * 100000, 10);
    //  window.sessionStorage.clientId = clientId;
    }

      // Set up the client
   client = new Paho.MQTT.Client(hostname, Number(port), clientId);
     
      client.onConnectionLost = onConnectionLost;

      client.onMessageArrived = onMessageArrived;

      // Set client options
     options = {
        onSuccess: connected, // After connected, subscribes
        onFailure: onFail,    // Useful for logging / debugging
	 
       	 //useSSL: true,
	//timeout: 3000

      };

 var sslDropdown = document.getElementById("ssl_input");
 options.useSSL = sslDropdown.value === "true";


if (authdropdown.value  ===  'true'){

 var authUsername = document.getElementById("username_input");
  options.userName = authUsername.value;

 var authpassword = document.getElementById("password_input");
  options.password = authpassword.value;

}

  var timeout = document.getElementById("timeout_input").value;
 options.timeout = parseInt(timeout*1000);

      // Connect the client
      client.connect(options);

if ((options.useSSL === true) && (authdropdown.value === 'false')) {
   logConsole('[' + getFormattedTimestamp() + '] Connecting to ' + ip + ':' + port + ' (SSL' + ', Timeout: ' + options.timeout/1000  + 's)');
}

if ((options.useSSL === false) && (authdropdown.value === 'false')) {
   logConsole('[' + getFormattedTimestamp() + '] Connecting to ' + ip + ':' + port + ' (Timeout: ' + options.timeout/1000  + 's)');
}

if ((options.useSSL === true) && (authdropdown.value === 'true')) {
   logConsole('[' + getFormattedTimestamp() + '] Connecting to ' + ip + ':' + port + ' (SSL, AUTH' + ', Timeout: ' + options.timeout/1000  + 's)');
}

if ((options.useSSL === false) && (authdropdown.value === 'true')) {
   logConsole('[' + getFormattedTimestamp() + '] Connecting to ' + ip + ':' + port + ' (AUTH, Timeout: ' + options.timeout/1000  + 's)');
}


await startCountup1();


document.getElementById('hostname_input').disabled = true;
	document.getElementById('port1_input').disabled = true;
	document.getElementById('port2_input').disabled = true;
	document.getElementById('port3_input').disabled = true;
	document.getElementById('port9_input').disabled = true;
	document.getElementById('timeout_text').disabled = true;
	document.getElementById('timeout_input').disabled = true;

  document.getElementById('mosquitto_radio').disabled = true;
      document.getElementById('emqx_radio').disabled = true;
      document.getElementById('mqtthq_radio').disabled = true;
      document.getElementById('other_radio').disabled = true;

	document.getElementById('port1_input').disabled = true;
	document.getElementById('port2_input').disabled = true;
	document.getElementById('port3_input').disabled = true;
	document.getElementById('port9_input').disabled = true;

        document.getElementById('ssl_input').disabled = true;

    document.getElementById('auth_input').disabled = true;
    document.getElementById('username_input').disabled = true;
    document.getElementById('password_input').disabled = true;

      // Show the clear button
      document.getElementById('clear_button').hidden = false;

      document.getElementById('connectiontext').hidden = false;
      document.getElementById('failedcounttext').hidden = false;
      document.getElementById('failedcount').hidden = false;
      document.getElementById('bar').hidden = false;
      document.getElementById('lostcounttext').hidden = false;
      document.getElementById('lostcount').hidden = false;
    document.getElementById('checkbox1_input').hidden = false;
    document.getElementById('checkbox1_text').hidden = false;

document.getElementById('reset_button').disabled = true;
document.getElementById('reset_button').hidden = false;





}
   


  async function reconnect() {

stopCountup();


      var mosquittoRadio = document.getElementById("mosquitto_radio");
      var emqxRadio = document.getElementById("emqx_radio");
      var mqtthqRadio = document.getElementById("mqtthq_radio");
      var otherRadio = document.getElementById("other_radio");

      hostname = document.getElementById('hostname_input').value;
      username = document.getElementById('username_input').value;
      password = document.getElementById('password_input').value;

       port1Input = document.getElementById("port1_input");
       port2Input = document.getElementById("port2_input");
       port3Input = document.getElementById("port3_input");
       port9Input = document.getElementById("port9_input");
 
     if (mosquittoRadio.checked) {port = port1Input.value;}
     if (emqxRadio.checked) {port = port2Input.value;} 
     if (mqtthqRadio.checked) {port = port3Input.value;} 
     if (otherRadio.checked) {port = port9Input.value;} 
    
    
      // Check if hostname is empty
      if (hostname === '') {
      return; // Stop further execution
      }

      // Check if port is empty
      if (port === '') {
      return; // Stop further execution
      }

	var authdropdown = document.getElementById('auth_input');
	
if (authdropdown.value  ===  'true'){
  if (username === '') {
        document.getElementById('username_input').placeholder = 'Please enter username!';

        return; // Stop further execution
      }

  if (password === '') {
        document.getElementById('password_input').placeholder = 'Please enter password!';

        return; // Stop further execution
      }

}

  // Regular expression patterns
  const ipPattern = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
  const domainPattern = /^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i;

  if (domainPattern.test(hostname)) {
   ip = await resolveDomain();
  } else if (ipPattern.test(hostname)) {
    ip = document.getElementById('hostname_input').value;
  } else {
    ip = document.getElementById('hostname_input').value;
  }  

    // Create client ID or load from storage
    if (window.sessionStorage.clientId) {
 clientId = "" + parseInt(Math.random() * 100000, 10);
    //  clientId = window.sessionStorage.clientId;
    } else {
      clientId = "" + parseInt(Math.random() * 100000, 10);
    //  window.sessionStorage.clientId = clientId;
    }

      // Set up the client
      client = new Paho.MQTT.Client(hostname, Number(port), clientId);
  

      // Connection result event handler
      client.onConnectionLost = onConnectionLost;

	// Error message event handler
      client.onMessageArrived = onMessageArrived;

      // Set client options
     options = {
        onSuccess: reconnected, // After connected, subscribes
        onFailure: onFail,    // Useful for logging / debugging
       	 //useSSL: true
      };

 var sslDropdown = document.getElementById("ssl_input");
 options.useSSL = sslDropdown.value === "true";

if (authdropdown.value  ===  'true'){

 var authUsername = document.getElementById("username_input");
  options.userName = authUsername.value;

 var authpassword = document.getElementById("password_input");
  options.password = authpassword.value;

}

 var timeout = document.getElementById("timeout_input");
 options.timeout = parseInt(timeout.value*1000);

      // Connect the client
      client.connect(options);

if (options.useSSL === true) {
 logConsole('[' + getFormattedTimestamp() + '] Reconnecting to ' + ip + ':' + port + ' (Use SSL' + ', Timeout: ' + options.timeout  + ')');
}

if (options.useSSL === false) {
 logConsole('[' + getFormattedTimestamp() + '] Reconnecting to ' + ip + ':' + port + ' (No SSL, Timeout: ' + options.timeout  + ')');
}



await startCountup2();


document.getElementById('hostname_input').disabled = true;
	document.getElementById('port1_input').disabled = true;
	document.getElementById('port2_input').disabled = true;
	document.getElementById('port3_input').disabled = true;
	document.getElementById('port9_input').disabled = true;
	document.getElementById('timeout_input').disabled = true;


  document.getElementById('mosquitto_radio').disabled = true;
      document.getElementById('emqx_radio').disabled = true;
      document.getElementById('mqtthq_radio').disabled = true;
      document.getElementById('other_radio').disabled = true;

	document.getElementById('port1_input').disabled = true;
	document.getElementById('port2_input').disabled = true;
	document.getElementById('port3_input').disabled = true;
	document.getElementById('port9_input').disabled = true;
        document.getElementById('ssl_input').disabled = true;

    document.getElementById('auth_input').disabled = true;
    document.getElementById('username_input').disabled = true;
    document.getElementById('password_input').disabled = true;

      // Show the clear button
      document.getElementById('clear_button').hidden = false;

    document.getElementById('connectiontext').hidden = false;
      document.getElementById('failedcounttext').hidden = false;
      document.getElementById('failedcount').hidden = false;
      document.getElementById('bar').hidden = false;
      document.getElementById('lostcounttext').hidden = false;
      document.getElementById('lostcount').hidden = false;
    document.getElementById('checkbox1_input').hidden = false;
    document.getElementById('checkbox1_text').hidden = false;
      



}

    


  async function disconnect() {
stopCountup();



var other_radio = document.getElementById('other_radio');
if (other_radio.checked) {
document.getElementById('hostname_input').disabled = false; }

      if (client) {
        logConsole('[' + getFormattedTimestamp() + ']' + ' Disconnecting from ' + ip + ':' + port);
        client.disconnect();
        logConsole('[' + getFormattedTimestamp() + ']' + ' Disconnected!');

  document.getElementById('mosquitto_radio').disabled = false;
      document.getElementById('emqx_radio').disabled = false;
      document.getElementById('mqtthq_radio').disabled = false;
      document.getElementById('other_radio').disabled = false;

      	document.getElementById('timeout_text').hidden = false;
	document.getElementById('timeout_input').hidden = false;
        document.getElementById('connect_button').hidden = false;
	document.getElementById('timeout_text').disabled = false;
	document.getElementById('timeout_input').disabled = false;
      document.getElementById('checkbox1_input').disabled = false;
   
            document.getElementById('connect_button').disabled = false;
	document.getElementById('connect_button').innerHTML = 'Connect';
        document.getElementById('disconnect_button').hidden = true;


      document.getElementById('connectiontext').hidden = true;
      document.getElementById('failedcounttext').hidden = true;
      document.getElementById('failedcount').hidden = true;
      document.getElementById('bar').hidden = true;
      document.getElementById('lostcounttext').hidden = true;
      document.getElementById('lostcount').hidden = true;
    document.getElementById('checkbox1_input').hidden = true;
    document.getElementById('checkbox1_text').hidden = true;

document.getElementById('reset_button').hidden = true;



        document.getElementById('topic_text').hidden = true;
          document.getElementById('sendhex_input').hidden = true;
    document.getElementById('sendhex_text').hidden = true;
        document.getElementById('topic_input').hidden = true;
        document.getElementById('subscribe_button').hidden = true;
             
        document.getElementById('unsubscribe_button').hidden = true;
        
        document.getElementById('message_text').hidden = true;
        document.getElementById('message_input').hidden = true;
        document.getElementById('sendqos_text').hidden = true;
        document.getElementById('sendqos_input').hidden = true;
        document.getElementById('retain_text').hidden = true;
        document.getElementById('retain_input').hidden = true;
        document.getElementById('send_button').hidden = true;
        document.getElementById('checkbox2text').hidden = true;
        document.getElementById('checkbox2').hidden = true;
   
        document.getElementById('port1_input').disabled = false;
        document.getElementById('port2_input').disabled = false;
        document.getElementById('port3_input').disabled = false;
        document.getElementById('port9_input').disabled = false;
        document.getElementById('ssl_input').disabled = false;
  	  document.getElementById('username_input').disabled = false;
   	 document.getElementById('password_input').disabled = false;
  	  document.getElementById('auth_input').disabled = false;
  	  document.getElementById('subqos_text').hidden = true;
  	  document.getElementById('subqos_input').hidden = true;



      }
    }






    function connected(context) {
      logConsole('[' + getFormattedTimestamp() + ']' + ' Connected! Client ID: ' + clientId);


      document.getElementById('mosquitto_radio').disabled = true;
      document.getElementById('emqx_radio').disabled = true;
      document.getElementById('mqtthq_radio').disabled = true;
      document.getElementById('other_radio').disabled = true;

      document.getElementById('clear_button').disabled = false;

      document.getElementById('hostname_input').disabled = true;
      document.getElementById('port1_input').disabled = true;
      document.getElementById('port2_input').disabled = true;
      document.getElementById('port3_input').disabled = true;
      document.getElementById('port9_input').disabled = true;
        document.getElementById('ssl_input').disabled = true;
     document.getElementById('timeout_text').disabled = true;
      document.getElementById('timeout_input').disabled = true;
      document.getElementById('connect_button').hidden = true;
	document.getElementById('connect_button').innerHTML = 'Connect';
      document.getElementById('disconnect_button').hidden = false;
      document.getElementById('checkbox1_input').disabled = false;
      document.getElementById('checkbox1_text').disabled = false;
     
    document.getElementById('checkbox1_input').hidden = false;
      document.getElementById('checkbox1_text').hidden = false;
      
      document.getElementById('connectiontext').hidden = false;
      document.getElementById('failedcounttext').hidden = false;
      document.getElementById('failedcount').hidden = false;
      document.getElementById('bar').hidden = false;
      document.getElementById('lostcounttext').hidden = false;
      document.getElementById('lostcount').hidden = false;
      document.getElementById('topic_text').hidden = false;
        document.getElementById('sendhex_input').hidden = false;
    document.getElementById('sendhex_text').hidden = false;
      document.getElementById('topic_input').hidden = false;
      document.getElementById('subqos_text').hidden = false;
      document.getElementById('subqos_input').hidden = false;
      document.getElementById('subqos_input').disabled = false;
      document.getElementById('topic_input').disabled = false;
      document.getElementById('subscribe_button').hidden = false;
         
      document.getElementById('subscribe_button').disabled = false;
    }  




 function reconnected(context) {
      logConsole('[' + getFormattedTimestamp() + ']' + ' Reconnected! Client ID: ' + clientId);


      document.getElementById('mosquitto_radio').disabled = true;
      document.getElementById('emqx_radio').disabled = true;
      document.getElementById('mqtthq_radio').disabled = true;
      document.getElementById('other_radio').disabled = true;

      document.getElementById('clear_button').disabled = false;

      document.getElementById('hostname_input').disabled = true;
      document.getElementById('port1_input').disabled = true;
      document.getElementById('port2_input').disabled = true;
      document.getElementById('port3_input').disabled = true;
      document.getElementById('port9_input').disabled = true;
        document.getElementById('ssl_input').disabled = true;
     document.getElementById('timeout_text').disabled = true;
      document.getElementById('timeout_input').disabled = true;
      document.getElementById('connect_button').hidden = true;
	document.getElementById('connect_button').innerHTML = 'Connect';
      document.getElementById('disconnect_button').hidden = false;
      document.getElementById('checkbox1_input').disabled = false;
      document.getElementById('checkbox1_text').disabled = false;
    document.getElementById('checkbox1_input').hidden = false;
      document.getElementById('checkbox1_text').hidden = false;


      document.getElementById('connectiontext').hidden = false;
      document.getElementById('failedcounttext').hidden = false;
      document.getElementById('failedcount').hidden = false;
      document.getElementById('bar').hidden = false;
      document.getElementById('lostcounttext').hidden = false;
      document.getElementById('lostcount').hidden = false;
      document.getElementById('topic_text').hidden = false;
        document.getElementById('sendhex_input').hidden = false;
    document.getElementById('sendhex_text').hidden = false;
      document.getElementById('topic_input').hidden = false;
      document.getElementById('subqos_text').hidden = false;
      document.getElementById('subqos_input').hidden = false;
      document.getElementById('subqos_input').disabled = false;
      document.getElementById('topic_input').disabled = false;
      document.getElementById('subscribe_button').hidden = false;
         
      document.getElementById('subscribe_button').disabled = false;
resubscribe();
    }








    function resubscribe(context) {
      topic = document.getElementById('topic_input').value;
   document.getElementById('subqos_text').disabled = true;
      document.getElementById('subqos_input').disabled = true;
    document.getElementById('subscribe_button').disabled = true;
            document.getElementById('topic_input').disabled = false;
       document.getElementById('subscribe_button').innerHTML = 'Subscribing';

  

      logConsole('[' + getFormattedTimestamp() + ']' + ' Resubscribing to Topic: ' + topic + ' ...');

      // And subscribe to our topics -- all with the same callback function
      options = { qos: 0, onSuccess: function (context) { logConsole('[' + getFormattedTimestamp() + ']' + ' Resubscribed! QoS: ' + options.qos); } }

 var subqosDropdown = document.getElementById("subqos_input");
       var selectedsubQoS = parseInt(subqosDropdown.value);
      options.qos = selectedsubQoS;

      client.subscribe(topic, options);


messageId = "Random Message #" + parseInt(Math.random() * 100000, 10);
      document.getElementById('message_input').value = messageId;


      document.getElementById('unsubscribe_button').hidden = false;
          
       document.getElementById('subscribe_button').innerHTML = 'Subscribe';
document.getElementById('subscribe_button').hidden = true;
     
      document.getElementById('topic_input').disabled = true;
      document.getElementById('message_text').hidden = false;
      document.getElementById('message_input').hidden = false;
      document.getElementById('sendqos_text').hidden = false;
      document.getElementById('sendqos_input').hidden = false;
      document.getElementById('retain_text').hidden = false;
      document.getElementById('retain_input').hidden = false;
      document.getElementById('send_button').hidden = false;
      document.getElementById('checkbox2text').hidden = false;
      document.getElementById('checkbox2').hidden = false;
 
document.getElementById('unsubscribe_button').hidden = false;


    }


   function subscribe(context) {
      topic = document.getElementById('topic_input').value;
   document.getElementById('subqos_text').disabled = true;
      document.getElementById('subqos_input').disabled = true;
    document.getElementById('subscribe_button').disabled = true;
            document.getElementById('topic_input').disabled = false;
       document.getElementById('subscribe_button').innerHTML = 'Subscribing';

  

      logConsole('[' + getFormattedTimestamp() + ']' + ' Subscribing to Topic: ' + topic + ' ...');

      // And subscribe to our topics -- all with the same callback function
      options = { qos: 0, onSuccess: function (context) { logConsole('[' + getFormattedTimestamp() + ']' + ' Subscribed! QoS: ' + options.qos); } }

 var subqosDropdown = document.getElementById("subqos_input");
       var selectedsubQoS = parseInt(subqosDropdown.value);
      options.qos = selectedsubQoS;

      client.subscribe(topic, options);




messageId = "Random Message #" + parseInt(Math.random() * 100000, 10);
      document.getElementById('message_input').value = messageId;



      document.getElementById('unsubscribe_button').hidden = false;
       document.getElementById('subscribe_button').innerHTML = 'Subscribe';
document.getElementById('subscribe_button').hidden = true;
     
      document.getElementById('topic_input').disabled = true;
      document.getElementById('message_text').hidden = false;
      document.getElementById('message_input').hidden = false;
      document.getElementById('sendqos_text').hidden = false;
      document.getElementById('sendqos_input').hidden = false;
      document.getElementById('retain_text').hidden = false;
      document.getElementById('retain_input').hidden = false;
      document.getElementById('send_button').hidden = false;
      document.getElementById('checkbox2text').hidden = false;
      document.getElementById('checkbox2').hidden = false;
 
document.getElementById('unsubscribe_button').hidden = false;



if (checkbox2.checked) {


    setTimeout(function() {


      send();
    }, 1000); // Delay of 1000 milliseconds (1 second)
  }


    }






    function unsubscribe(context) {
      topic = document.getElementById('topic_input').value;
      logConsole('[' + getFormattedTimestamp() + ']' + ' Unsubscribing from Topic: ' + topic + ' ...');

      document.getElementById('subscribe_button').hidden = false;
     
      document.getElementById('subscribe_button').disabled = false;
      document.getElementById('unsubscribe_button').hidden = true;
      document.getElementById('topic_input').disabled = false;
      document.getElementById('subqos_text').disabled = false;
      document.getElementById('subqos_input').disabled = false;
      document.getElementById('message_text').hidden = true;
      document.getElementById('message_input').hidden = true;
      document.getElementById('sendqos_text').hidden = true;
      document.getElementById('sendqos_input').hidden = true;
      document.getElementById('retain_text').hidden = true;
      document.getElementById('retain_input').hidden = true;
      document.getElementById('send_button').hidden = true;
      document.getElementById('checkbox2text').hidden = true;
      document.getElementById('checkbox2').hidden = true;
      

      client.unsubscribe(topic);
      logConsole('[' + getFormattedTimestamp() + ']' + ' Unsubscribed!');
    }




    function onFail(responseObject) {

document.getElementById('reset_button').disabled = false;
document.getElementById('reset_button').hidden = false;

 onFailCalled = true;

      logConsole('[' + getFormattedTimestamp() + ']' + ' Failed to Connect!' + ' Error: ' + responseObject.errorMessage);

  document.getElementById('mosquitto_radio').disabled = false;
      document.getElementById('emqx_radio').disabled = false;
      document.getElementById('mqtthq_radio').disabled = false;
      document.getElementById('other_radio').disabled = false;
	document.getElementById('hostname_input').disabled = false;
      document.getElementById('port1_input').disabled = false;
      document.getElementById('port2_input').disabled = false;
      document.getElementById('port3_input').disabled = false;
      document.getElementById('port9_input').disabled = false;
        document.getElementById('ssl_input').disabled = false;
        document.getElementById('auth_input').disabled = false;
   document.getElementById('timeout_text').disabled = false;
      document.getElementById('timeout_input').disabled = false;
      document.getElementById('connect_button').disabled = false;
      document.getElementById('connect_button').hidden = false;
      document.getElementById('connect_button').innerHTML = 'Connect';

     document.getElementById('connectiontext').hidden = false;
      document.getElementById('failedcounttext').hidden = false;
      document.getElementById('failedcount').hidden = false;
      document.getElementById('bar').hidden = false;
      document.getElementById('lostcounttext').hidden = false;
      document.getElementById('lostcount').hidden = false;
   document.getElementById('checkbox1_input').hidden = false;
    document.getElementById('checkbox1_text').hidden = false;
     

  failedcount++;
  updatefailedcount();

  var checkbox1 = document.getElementById('checkbox1_input');
  if (checkbox1.checked) {reconnect();}

      document.getElementById('username_input').disabled = false;
      document.getElementById('password_input').disabled = false;

    }




    function onConnectionLost(responseObject) {

document.getElementById('reset_button').disabled = false;
document.getElementById('reset_button').hidden = false;

      if (responseObject.errorCode !== 0) {
        logConsole('[' + getFormattedTimestamp() + ']' + ' Connection Lost! ' + 'Error: ' + responseObject.errorMessage);
 document.getElementById('connect_button').innerHTML = 'Connect';
document.getElementById('connect_button').disabled = false;
document.getElementById('connect_button').hidden = false;
document.getElementById('disconnect_button').hidden = true;
   document.getElementById('mosquitto_radio').disabled = false;
      document.getElementById('emqx_radio').disabled = false;
      document.getElementById('mqtthq_radio').disabled = false;
      document.getElementById('other_radio').disabled = false;
	document.getElementById('hostname_input').disabled = false;
      document.getElementById('port1_input').disabled = false;
      document.getElementById('port2_input').disabled = false;
      document.getElementById('port3_input').disabled = false;
      document.getElementById('port9_input').disabled = false;
        document.getElementById('ssl_input').disabled = false;
        document.getElementById('auth_input').disabled = false;
   document.getElementById('timeout_text').disabled = false;
      document.getElementById('timeout_input').disabled = false;
document.getElementById('checkbox1_input').disabled = false;

    
     document.getElementById('connectiontext').hidden = false;
      document.getElementById('failedcounttext').hidden = false;
      document.getElementById('failedcount').hidden = false;
      document.getElementById('bar').hidden = false;
      document.getElementById('lostcounttext').hidden = false;
      document.getElementById('lostcount').hidden = false;

 document.getElementById('topic_text').hidden = true;
   document.getElementById('sendhex_input').hidden = true;
    document.getElementById('sendhex_text').hidden = true;
 document.getElementById('topic_input').hidden = true;
 document.getElementById('subqos_text').hidden = true;
 document.getElementById('subqos_input').hidden = true;
 document.getElementById('unsubscribe_button').hidden = true;
 document.getElementById('message_text').hidden = true;
 document.getElementById('message_input').hidden = true;
 document.getElementById('sendqos_text').hidden = true;
 document.getElementById('sendqos_input').hidden = true;
 document.getElementById('retain_text').hidden = true;
 document.getElementById('retain_input').hidden = true;
 document.getElementById('send_button').hidden = true;
 document.getElementById('checkbox2').hidden = true;
 document.getElementById('checkbox2text').hidden = true;
 
   document.getElementById('checkbox1_input').hidden = false;
    document.getElementById('checkbox1_text').hidden = false;
     


  // Increment the message count
  lostcount++;

  // Update the message count in the HTML
  updatelostcount();


 var checkbox1 = document.getElementById('checkbox1_input');
   if (checkbox1.checked) {reconnect();}
    
          }
    }



    function onMessageArrived(message) {
        
       if (sendhex.checked) {

    // Get the received payload as an ArrayBuffer
    let receivedPayload = message.payloadBytes.buffer;

    // Convert the ArrayBuffer to a Uint8Array
    let uint8Payload = new Uint8Array(receivedPayload);

    // Convert the Uint8Array to a hexadecimal string
    let hexString = uint8ArrayToHexString(uint8Payload);

    logConsole('[' + getFormattedTimestamp() + ']' + ' Receiving: ' + uint8Payload + ' (QoS: ' + message.qos + ')');
    
        }
        
      else {
  var topicArrived = message.destinationName;
  var senderArrived = topicArrived.split("/")[1];

 onMessageArrivedCalled = true;

  // if (message.retained === true) {logConsole('[' + getFormattedTimestamp() + ']' + ' Receiving Retained Message: ' + message.payloadString + ' (Publisher: Client #' + senderArrived + ', QoS: ' + message.qos + ')');}
   if (message.retained === true) {logConsole('[' + getFormattedTimestamp() + ']' + ' Receiving Retained Message: ' + message.payloadString + ' (QoS: ' + message.qos + ')');}

//  if (message.retained === false) {logConsole('[' + getFormattedTimestamp() + ']' + ' Receiving: ' + message.payloadString + ' (From: Client #' + senderArrived + ', QoS: ' + message.qos + ')');}
   if (message.retained === false) {logConsole('[' + getFormattedTimestamp() + ']' + ' Receiving: ' + message.payloadString + ' (QoS: ' + message.qos + ')');}

   
}

    }



    function send() {

var sendhex = document.getElementById('sendhex_input');
   if (sendhex.checked) {
       // Retrieve the hexadecimal input value from the HTML element
var inputHex = document.getElementById('message_input').value;

// Remove any spaces from the input string
inputHex = inputHex.replace(/\s/g, '');

// Split the input string into pairs of characters
var hexPairs = inputHex.match(/.{1,2}/g);

// Convert the hex pairs to byte values
var hexPayloadBytes = hexPairs.map(pair => parseInt(pair, 16));

// Convert the byte values to a Uint8Array
var payload = new Uint8Array(hexPayloadBytes);

// Create an MQTT message with the payload
var message = new Paho.MQTT.Message(payload.buffer);
  }
else {
    var messagecontent = document.getElementById('message_input').value;
   var payload = messagecontent;
    message = new Paho.MQTT.Message(payload);
}



      // Send message
    
     
      message.destinationName = topic;
       var sendqosDropdown = document.getElementById("sendqos_input");
       var selectedsendQoS = parseInt(sendqosDropdown.value);
       message.qos = selectedsendQoS;

      var retainDropdown = document.getElementById("retain_input");
      var selectedRetain = retainDropdown.value === "true"; // Convert the string value to boolean
      message.retained = selectedRetain;


 client.send(message);

if (selectedRetain === true) {logConsole('[' + getFormattedTimestamp() + ']' + ' Sending: ' + payload + ' (QoS: ' + message.qos + ', Retain: Yes)');}

if (selectedRetain === false) {logConsole('[' + getFormattedTimestamp() + ']' + ' Sending: ' + payload + ' (QoS: ' + message.qos + ', Retain: No)');}

   if (sendhex.checked) {
       

  }
else {
    
    
messageId = "Random Message #" + parseInt(Math.random() * 100000, 10);
     document.getElementById('message_input').value = messageId;
  
}






if (checkbox2.checked) {


    setTimeout(function() {


      send();
    }, 1000); // Delay of 1000 milliseconds (1 second)
  }



    }

  



function logConsole(message) {
  var consoleElement = document.getElementById('console');

  var lineElement = document.createElement('span');
  lineElement.textContent = message;

if (message.includes('Failed to Connect') || message.includes('Connection Lost')) {
    // Apply CSS styles to the line
    lineElement.style.backgroundColor = 'red';
    lineElement.style.color = 'white';
  } else {
    // Apply default CSS styles to the line
    lineElement.style.backgroundColor = 'black';
    lineElement.style.color = 'white';
  }

  consoleElement.style.fontFamily = 'Terminal';
  consoleElement.style.backgroundColor = 'black';
  consoleElement.insertBefore(lineElement, consoleElement.firstChild);
  consoleElement.insertBefore(document.createElement('br'), consoleElement.firstChild);

  if (consoleElement.innerHTML !== '') {
    document.getElementById('clear_button').disabled = false;
  }
}




    function clearConsole() {
      var consoleElement = document.getElementById('console');
      consoleElement.innerHTML = "";
      document.getElementById('clear_button').disabled = true;
     
      logConsole('[' + getFormattedTimestamp() + ']' + ' New Console Initialized!');
     
    }




    function getFormattedTimestamp() {
      var now = new Date();
      var day = now.getDate();
      var month = now.getMonth() + 1;
      var year = now.getFullYear();
      var hour = now.getHours();
      var minute = now.getMinutes();
      var second = now.getSeconds();
      var period = hour >= 12 ? 'PM' : 'AM';

      // Format single-digit day and month
      day = day < 10 ? '0' + day : day;
      month = month < 10 ? '0' + month : month;

      // Format hour and minute
      hour = hour % 12;
      hour = hour ? hour : 12; // Display 12 instead of 0
      minute = minute < 10 ? '0' + minute : minute;

      var formattedTimestamp = day + '/' + month + '/' + year + ' ' + hour + ':' + minute + ':' + second + ' ' + period;
      return formattedTimestamp;
    }

    // Update hostname and port based on selected radio option
    var radioOptions = document.getElementsByName('mqtt_server');
    for (var i = 0; i < radioOptions.length; i++) {
      radioOptions[i].addEventListener('change', function () {




        if (this.value === 'test.mosquitto.org') {
stopCountup();

value = storage.getItem('key');
    if (value === '1') {
    document.getElementById("checkbox3_input").checked = true;
 document.getElementById('hostname_input').value = 'test.mosquitto.org';
    connect();
    }

document.getElementById('hostname_text').hidden = false;
document.getElementById('hostname_input').hidden = false;
document.getElementById('port1_text').hidden = false;
document.getElementById('port1_input').hidden = false;
document.getElementById('port2_text').hidden = false;
document.getElementById('port2_input').hidden = false;
document.getElementById('port3_text').hidden = false;
document.getElementById('port3_input').hidden = false;
document.getElementById('port9_text').hidden = false;
document.getElementById('port9_input').hidden = false;
document.getElementById('ssl_text').hidden = false;
document.getElementById('ssl_input').hidden = false;
document.getElementById('auth_text').hidden = false;
document.getElementById('auth_input').hidden = false;
document.getElementById('timeout_text').hidden = false;
document.getElementById('timeout_input').hidden = false;
document.getElementById('checkbox1_input').hidden = true;
document.getElementById('checkbox1_text').hidden = true;

document.getElementById('connect_button').hidden = false;

          document.getElementById('hostname_input').disabled = true;
          document.getElementById('hostname_input').value = 'test.mosquitto.org';
          document.getElementById('port1_input').hidden = false;
          document.getElementById('port1_text').hidden = false;
        document.getElementById('port2_input').hidden = true;
          document.getElementById('port2_text').hidden = true;
       document.getElementById('port3_input').hidden = true;
          document.getElementById('port3_text').hidden = true;
   	document.getElementById('port9_text').hidden = true;
        document.getElementById('port9_input').hidden = true;

document.getElementById('connectiontext').hidden = true;
document.getElementById('failedcounttext').hidden = true;
document.getElementById('failedcount').hidden = true;
document.getElementById('bar').hidden = true;
document.getElementById('lostcounttext').hidden = true;
document.getElementById('lostcount').hidden = true;
document.getElementById('checkbox1_input').hidden = true;
document.getElementById('checkbox1_text').hidden = true;

document.getElementById('reset_button').hidden = true;



var dropdown = document.getElementById('ssl_input');
dropdown.value = dropdown.options[0].value;
var port = document.getElementById('port1_input').value;

document.getElementById('topic_input').value = storage.getItem('customtopic');
document.getElementById('username_text').hidden = true;
document.getElementById('username_input').hidden = true;
document.getElementById('password_text').hidden = true;
document.getElementById('password_input').hidden = true;


        } if (this.value === 'broker.emqx.io') {

stopCountup();

value = storage.getItem('key');
    if (value === '1') {
    document.getElementById("checkbox3_input").checked = true;
   document.getElementById('hostname_input').value = 'broker.emqx.io';
    connect();
    }

document.getElementById('hostname_text').hidden = false;
document.getElementById('hostname_input').hidden = false;
document.getElementById('port1_text').hidden = false;
document.getElementById('port1_input').hidden = false;
document.getElementById('port2_text').hidden = false;
document.getElementById('port2_input').hidden = false;
document.getElementById('port3_text').hidden = false;
document.getElementById('port3_input').hidden = false;
document.getElementById('port9_text').hidden = false;
document.getElementById('port9_input').hidden = false;
document.getElementById('ssl_text').hidden = false;
document.getElementById('ssl_input').hidden = false;
document.getElementById('auth_text').hidden = false;
document.getElementById('auth_input').hidden = false;
document.getElementById('timeout_text').hidden = false;
document.getElementById('timeout_input').hidden = false;
document.getElementById('checkbox1_input').hidden = true;
document.getElementById('checkbox1_text').hidden = true;

document.getElementById('connect_button').hidden = false;

          document.getElementById('hostname_input').disabled = true;
          document.getElementById('hostname_input').value = 'broker.emqx.io';
          document.getElementById('port1_input').hidden = true;
          document.getElementById('port1_text').hidden = true;
        document.getElementById('port2_input').hidden = false;
          document.getElementById('port2_text').hidden = false;
     document.getElementById('port3_input').hidden = true;
          document.getElementById('port3_text').hidden = true;
   document.getElementById('port9_text').hidden = true;
        document.getElementById('port9_input').hidden = true;

document.getElementById('connectiontext').hidden = true;
document.getElementById('failedcounttext').hidden = true;
document.getElementById('failedcount').hidden = true;
document.getElementById('bar').hidden = true;
document.getElementById('lostcounttext').hidden = true;
document.getElementById('lostcount').hidden = true;
document.getElementById('checkbox1_input').hidden = true;
document.getElementById('checkbox1_text').hidden = true;

document.getElementById('reset_button').hidden = true;



var dropdown = document.getElementById('ssl_input');
dropdown.value = dropdown.options[0].value;
var selectport = document.getElementById('port2_input');
selectport.value = selectport.options[3].value;
var port = document.getElementById('port2_input').value;

document.getElementById('topic_input').value = storage.getItem('customtopic');

document.getElementById('username_text').hidden = true;
document.getElementById('username_input').hidden = true;
document.getElementById('password_text').hidden = true;
document.getElementById('password_input').hidden = true;



        } if (this.value === 'public.mqtthq.com') {

stopCountup();

value = storage.getItem('key');
    if (value === '1') {
    document.getElementById("checkbox3_input").checked = true;
  document.getElementById('hostname_input').value = 'public.mqtthq.com';
    connect();
    }

document.getElementById('hostname_text').hidden = false;
document.getElementById('hostname_input').hidden = false;
document.getElementById('port1_text').hidden = false;
document.getElementById('port1_input').hidden = false;
document.getElementById('port2_text').hidden = false;
document.getElementById('port2_input').hidden = false;
document.getElementById('port3_text').hidden = false;
document.getElementById('port3_input').hidden = false;
document.getElementById('port9_text').hidden = false;
document.getElementById('port9_input').hidden = false;
document.getElementById('ssl_text').hidden = false;
document.getElementById('ssl_input').hidden = false;
document.getElementById('auth_text').hidden = false;
document.getElementById('auth_input').hidden = false;
document.getElementById('timeout_text').hidden = false;
document.getElementById('timeout_input').hidden = false;
document.getElementById('checkbox1_input').hidden = true;
document.getElementById('checkbox1_text').hidden = true;
 
document.getElementById('connect_button').hidden = false;
document.getElementById('hostname_input').disabled = true;
document.getElementById('hostname_input').value = 'public.mqtthq.com';
document.getElementById('port1_input').hidden = true;
document.getElementById('port1_text').hidden = true;
document.getElementById('port2_input').hidden = true;
document.getElementById('port2_text').hidden = true;
document.getElementById('port3_input').hidden = false;
document.getElementById('port3_text').hidden = false;
document.getElementById('port9_text').hidden = true;
document.getElementById('port9_input').hidden = true;

document.getElementById('connectiontext').hidden = true;
document.getElementById('failedcounttext').hidden = true;
document.getElementById('failedcount').hidden = true;
document.getElementById('bar').hidden = true;
document.getElementById('lostcounttext').hidden = true;
document.getElementById('lostcount').hidden = true;
document.getElementById('checkbox1_input').hidden = true;
document.getElementById('checkbox1_text').hidden = true;

document.getElementById('reset_button').hidden = true;



var dropdown = document.getElementById('ssl_input');
dropdown.value = dropdown.options[0].value;
var selectport = document.getElementById('port3_input');
selectport.value = selectport.options[2].value;

 var port = document.getElementById('port3_input').value;

document.getElementById('topic_input').value = storage.getItem('customtopic');

document.getElementById('username_text').hidden = true;
document.getElementById('username_input').hidden = true;
document.getElementById('password_text').hidden = true;
document.getElementById('password_input').hidden = true;

var ssldropdown = document.getElementById('ssl_input');
ssldropdown.selectedIndex = 0;

var authdropdown = document.getElementById('auth_input');
authdropdown.selectedIndex = 1;

var subqosdropdown = document.getElementById('subqos_input');
subqosdropdown.selectedIndex = 2;

var sendqosdropdown = document.getElementById('sendqos_input');
sendqosdropdown.selectedIndex = 2;



} if (this.value === 'other_server') {

stopCountup();

value = storage.getItem('key');
if (value === '1') {
document.getElementById("checkbox3_input").checked = true;
document.getElementById('hostname_input').value = storage.getItem('customhostname');
document.getElementById('port9_input').value = storage.getItem('customport'); connect();}

document.getElementById('hostname_text').hidden = false;
document.getElementById('hostname_input').hidden = false;
document.getElementById('port9_text').hidden = false;
document.getElementById('port9_input').hidden = false;
document.getElementById('auth_text').hidden = false;
document.getElementById('auth_input').hidden = false;
document.getElementById('timeout_text').hidden = false;
document.getElementById('timeout_input').hidden = false;
document.getElementById('checkbox1_input').hidden = true;
document.getElementById('checkbox1_text').hidden = true;

document.getElementById('connect_button').hidden = false;
document.getElementById('hostname_input').disabled = false;
document.getElementById('hostname_input').value = storage.getItem('customhostname');
document.getElementById('port9_input').value = storage.getItem('customport');
document.getElementById('timeout_input').value = storage.getItem('customtimeout');
document.getElementById('topic_input').value = storage.getItem('customtopic');

document.getElementById('port1_input').hidden = true;
document.getElementById('port1_text').hidden = true;
document.getElementById('port2_input').hidden = true;
document.getElementById('port2_text').hidden = true;
document.getElementById('port3_input').hidden = true;
document.getElementById('port3_text').hidden = true;
document.getElementById('ssl_text').hidden = false;
document.getElementById('ssl_input').hidden = false;

document.getElementById('connectiontext').hidden = true;
document.getElementById('failedcounttext').hidden = true;
document.getElementById('failedcount').hidden = true;
document.getElementById('bar').hidden = true;
document.getElementById('lostcounttext').hidden = true;
document.getElementById('lostcount').hidden = true;
document.getElementById('checkbox1_input').hidden = true;
document.getElementById('checkbox1_text').hidden = true;

document.getElementById('reset_button').hidden = true;



var savedssl = localStorage.getItem('selectedsslOption');
var ssldropdown = document.getElementById('ssl_input');
ssldropdown.selectedIndex = savedssl;

var savedauth = localStorage.getItem('selectedauthOption');
var authdropdown = document.getElementById('auth_input');
authdropdown.selectedIndex = savedauth;

var savedsubqos = localStorage.getItem('selectedsubqosOption');
var subqosdropdown = document.getElementById('subqos_input');
subqosdropdown.selectedIndex = savedsubqos;

var savedsendqos = localStorage.getItem('selectedsendqosOption');
var sendqosdropdown = document.getElementById('sendqos_input');
sendqosdropdown.selectedIndex = savedsendqos;

var port = document.getElementById('port9_input').value;

var selectauth = document.getElementById("auth_input").value;

if (selectauth === "true") {
  document.getElementById("username_text").hidden = false;
  document.getElementById("username_input").hidden = false;
  document.getElementById("password_text").hidden = false;
  document.getElementById("password_input").hidden = false;

 document.getElementById('username_input').value = storage.getItem('customusername');
 document.getElementById('password_input').value = storage.getItem('custompassword');

var hostname = document.getElementById('hostname_input').value;




}


        }
      });
    }





async function resolveDomain() {

  var domain = document.getElementById('hostname_input').value;

  var ip = null;

  try {
    logConsole('[' + getFormattedTimestamp() + ']' + ' Resolving ' + domain);
    var response = await fetch(`https://dns.google/resolve?name=${domain}`);
    if (response.ok) {
      var data = await response.json();
      ip = data.Answer[0].data;
      logConsole('[' + getFormattedTimestamp() + ']' + ' Resolved! IP: ' + ip);
    } else {
      logConsole('[' + getFormattedTimestamp() + ']' + ' Failed to resolve IP address for ' + domain);
    }
  } catch (error) {
    logConsole('[' + getFormattedTimestamp() + ']' + ' An error occurred: ' + error.message);
return error;
  }

  return ip;

}

// Initialize the counter variable
let lostcount = 0;
let failedcount = 0;

  
function updatelostcount() {
const lostcounttextElement = document.getElementById('lostcounttext');
   lostcounttextElement.style.color = 'red';
  const lostcountElement = document.getElementById('lostcount');
  lostcountElement.style.color = 'red';
  lostcountElement.textContent = lostcount.toString();
 document.getElementById('reset_button').hidden = false;
}

// Update the failedcount in the HTML
function updatefailedcount() {
const failedcounttextElement = document.getElementById('failedcounttext');
  failedcounttextElement.style.color = 'red';
const failedcountElement = document.getElementById('failedcount');
  failedcountElement.style.color = 'red';
  failedcountElement.textContent = failedcount.toString();
 document.getElementById('reset_button').hidden = false;

}








 var checkbox1 = document.getElementById('checkbox1_input');

function checkbox1Changed() {
   if (checkbox1.checked) {
  logConsole('[' + getFormattedTimestamp() + '] Automatic Reconnect Upon Connection Failed/Lost Enabled!');


  }
else {
  logConsole('[' + getFormattedTimestamp() + '] Automatic Reconnect Upon Connection Failed/Lost Disabled!');
 var connecting = document.getElementById('connect_button');
         connecting.innerHTML = 'Awaiting Response';
}
}




 var sendhex = document.getElementById('sendhex_input');

function sendhexchanged() {
   if (sendhex.checked) {
  logConsole('[' + getFormattedTimestamp() + '] Send/Receive in HEX enabled!');
  
    document.getElementById('message_input').value = '01 06 00 06 00 02 E8 0A';



  }
else {
  logConsole('[' + getFormattedTimestamp() + '] Send/Receive in HEX disabled!');
messageId = "Random Message #" + parseInt(Math.random() * 100000, 10);
     document.getElementById('message_input').value = messageId;
}
}









 var checkbox2 = document.getElementById('checkbox2');

function checkbox2Changed() {
   if (checkbox2.checked) {
      document.getElementById('message_input').disabled = true;
      document.getElementById('sendqos_input').disabled = true;
      document.getElementById('retain_input').disabled = true;
      document.getElementById('send_button').disabled = true;
    // Perform actions when the checkbox is checked
//    logConsole('[' + getFormattedTimestamp() + '] Automatic Publish A Random Message At One-Second Intervals Enabled!');

    // Call your function or perform any desired actions here
        send();
   
  }
else {
  document.getElementById('message_input').disabled = false;
      document.getElementById('sendqos_input').disabled = false;
      document.getElementById('retain_input').disabled = false;
      document.getElementById('send_button').disabled = false;

  //  logConsole('[' + getFormattedTimestamp() + '] Automatic Publish Random Message At One-Second Intervals Disabled!');
}
}






function resetcounter() {
    logConsole('[' + getFormattedTimestamp() + '] Connection Counter Resetted!');
failedcount = 0;
lostcount = 0;

const lostcounttextElement = document.getElementById('lostcounttext');
  const lostcountElement = document.getElementById('lostcount');
 lostcounttextElement.style.color = 'black';
  lostcountElement.style.color = 'black';
  lostcountElement.textContent = 0;


const failedcounttextElement = document.getElementById('failedcounttext');
const failedcountElement = document.getElementById('failedcount');
  failedcounttextElement.style.color = 'black';
  failedcountElement.style.color = 'black';
  failedcountElement.textContent = 0;

document.getElementById('reset_button').disabled = true;
//   document.getElementById('connectiontext').hidden = true;
 //     document.getElementById('failedcounttext').hidden = true;
  //    document.getElementById('failedcount').hidden = true;
   //   document.getElementById('bar').hidden = true;
    //  document.getElementById('lostcounttext').hidden = true;
    //  document.getElementById('lostcount').hidden = true;


  }

var onMessageArrivedCalled = false;
var onFailCalled = false;
var countupInterval1; // Variable to hold the interval ID

async function startCountup1() {
  var countingup1 = 0;
  var connectbutton1 = document.getElementById("connect_button");

  if (connectbutton1.innerHTML.includes('Connect')) {
    connectbutton1.disabled = true;
    connectbutton1.innerHTML = "Connecting (0)";
  }

  countupInterval1 = setInterval(function() {
    countingup1++;

    if (connectbutton1.innerHTML.includes('Connecting')) {
      connectbutton1.innerHTML = "Connecting (" + countingup1 + ")";
    }

    if (onMessageArrivedCalled) {
      stopCountup();
    }

    if (onFailCalled) {
      stopCountup();
    }
  }, 1000);
}



     var countupInterval2; // Variable to hold the interval ID

async function startCountup2() {
 stopCountup();
  var countingup2 = 0;
  var connectbutton2 = document.getElementById("connect_button");

  if (connectbutton2.innerHTML.includes('Connect')) {
    connectbutton2.disabled = true;
    connectbutton2.innerHTML = "Reconnecting (0)";
  }

  countupInterval2 = setInterval(function() {
    countingup2++;

    if (connectbutton2.innerHTML.includes('Reconnecting')) {
      connectbutton2.innerHTML = "Reconnecting (" + countingup2 + ")";
    }

    if (onMessageArrivedCalled) {
      stopCountup();
    }

    if (onFailCalled) {
      stopCountup();
    }
  }, 1000);
}



function stopCountup() {
onMessageArrivedCalled = false;
 onFailCalled = false;
clearInterval(countupInterval1);
clearInterval(countupInterval2);
var connectbutton1 = document.getElementById("connect_button");
//connectbutton1.innerHTML = "Awaiting Response";
//connectbutton1.disabled = true;
}





function checkbox3Changed() {

 var checkbox3 = document.getElementById('checkbox3_input');
   if (checkbox3.checked) {
storage.setItem('key', '1');     
    logConsole('[' + getFormattedTimestamp() + '] Automatic Connect Enabled!');

var radioBtn1 = document.getElementById('mosquitto_radio');
if (radioBtn1.checked) {connect();}

var radioBtn2 = document.getElementById('emqx_radio');
if (radioBtn2.checked) {connect();}

var radioBtn3 = document.getElementById('mqtthq_radio');
if (radioBtn3.checked) {connect();}

var radioBtn4 = document.getElementById('other_radio');
if (radioBtn4.checked) {connect();}


  }
else {
 storage.setItem('key', '0');
   logConsole('[' + getFormattedTimestamp() + '] Automatic Connect Disabled!');
}


}


function hostnameChanged()
{
var otherradio = document.getElementById('other_radio');
if (otherradio.checked) {
var customhostname = document.getElementById('hostname_input').value;
localStorage.setItem('customhostname', customhostname);  }
}


function port9Changed()
{
var otherradio = document.getElementById('other_radio');
if (otherradio.checked) {
var customport = document.getElementById('port9_input').value;
localStorage.setItem('customport', customport);}
}

function timeoutChanged()
{

var customtimeout = document.getElementById('timeout_input').value;
localStorage.setItem('customtimeout', customtimeout);
}

function topicChanged()
{
var customtopic = document.getElementById('topic_input').value;
localStorage.setItem('customtopic', customtopic);
}

function messageChanged()
{
var custommessage = document.getElementById('message_input').value;
localStorage.setItem('custommessage', custommessage);
}


function subqosChanged()
{
var selectsubqos = document.getElementById("subqos_input");
var selectsubqosOption = selectsubqos.selectedIndex ;
localStorage.setItem('selectsubqosOption', selectsubqosOption);
}


function sendqosChanged()
{
var selectsendqos = document.getElementById("sendqos_input");
var selectsendqosOption = selectsendqos.selectedIndex ;
localStorage.setItem('selectsendqosOption', selectsendqosOption);
}

function retainChanged()
{
var selectretain = document.getElementById("retain_input");
var selectretainOption = selectretain.selectedIndex ;
localStorage.setItem('selectretainOption', selectretainOption);
}

function usernameChanged()
{
var other_radio = document.getElementById('other_radio');
if (other_radio.checked) {
var customusername = document.getElementById('username_input').value;
localStorage.setItem('customusername', customusername);}
}

function passwordChanged()
{
var other_radio = document.getElementById('other_radio');
if (other_radio.checked) {
var custompassword = document.getElementById('password_input').value;
localStorage.setItem('custompassword', custompassword);}
}


// Convert a string to hexadecimal representation
function stringToHex(str) {
    let hex = '';
    for (let i = 0; i < str.length; i++) {
        hex += str.charCodeAt(i).toString(16).padStart(2, '0');
    }
    return hex;
}



// Convert a Uint8Array to a hexadecimal string
function uint8ArrayToHexString(uint8Array) {
    return Array.from(uint8Array, byte => byte.toString(16).padStart(2, '0')).join('');
}




  </script>
</body>
</html>
